# 计算概论作业3

## 为什么使用cache

因为主存慢而CPU快，会导致昂贵的CPU空等而影响效率。而CPU在一定时间内从主存取指令或取数据，只是对主存局部地址区域的访问，并且有些指令和数据往往会被多次调用，即指令和数据在主存的地址分布是相对集中的，使得CPU在执行程序时，访存具有相对的局部性。因此只要将CPU近期要用到的程序和数据， 提前从主存送到Cache， 那么就可以做到CPU在一定时间内只访问Cache。一般Cache速度比主存快，价格比主存贵，但因其容量远小于主存，因此能很好地解决速度和成本的矛盾。

## cache的结构

(1)Cache存储体：存放由主存调入的指令与数据块。

(2)地址映象变换机构：将CPU送来的主存地址转换为Cache地址。由于主存和Cache的块大小相同，块内低位地址相同，因此地址变换主要是主存的块号(高位地址)与Cache块号间的转换。若cache原来处于装满的状态。即已无法将主存块调入Cache内时，就得采用替换策略。

(3)替换机构。当Cache内容已满，无法接受来自主存块的信息时，就由Cache内的替换机构按一定的替换算法来确定应从Cache内移出哪个块返回主存，而把新的主存块调入Cache

# cache工作原理

主存由2^n个可编址的字组成，每个字有惟一的n位地址。为了与Cache映射，将主存与缓存都分成若干块，每块内又包含若干个字，并使它们的块内字数相同。这就将主存的地址分成两段：高m位表示主存的块地址，低b位表示块内地址，则2m＝N表示主存的块数。缓存的地址也分为两段：高c位表示缓存的块号，低b位表示块内地址，则2^c=C表示缓存块数，且C远小于N。主存与缓存地址中都用b位表示其块内字数，即B=2b 反映了块的大小，记为块长。任何时刻都有一些主存块处在缓存块中。CPU欲读取主存某字时，有两种可能：一种是所需要的字已在缓存中，即可直接访问Cache(CPU与Cache之间通常一次传送一个字)，此种情况称为CPU访问Cache命中；另一种是所需的字不在Cache内，此时需将该字所在的主存整个字块一次调入Cache中，此种情况称CPU访问Cache不命中。如果主存块已调入缓存块，则称该主存块与缓存块建立了对应关系。由于缓存的块数C远小于主存的块数N，因此，一个缓存块不能惟一地、永久地只对应一个主存块，故每个缓存块需设一个标记用来表示当前存放的是哪一个主存块，该标记的内容相当于主存块的编号。CPU读信息时，要将主存地址的高m位 (或m位中的一部分)与缓存块的标记进行比较，以判断所读的信息是否已在缓存中。Cache的容量与块长是影响Cache效率的重要因素，通常用“命中率”来衡量Cache的效率。命中率是指CPU要访问的信息已在Cache内的比率。一般而言，Cache容量越大，其CPU的命中率就越高。但当Cache容量达到一定值时，命中率已不因容量的增大而有明显的提高。块长与命中率之间的关系更为复杂，它取决于各程序的局部特性。

